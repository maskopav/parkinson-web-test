<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Parkinson Web Test - Voice Recording</title>
    <link rel="stylesheet" href="src/styles.css">
</head>
<body>
    <!-- Global error banner -->
    <div id="global-error" class="global-error-banner" style="display: none;"></div>

    <div class="container">
        <header>
            <h1>Parkinson Web Test Application</h1>
            <p>Voice Recording Module</p>
        </header>
        
        <!-- Patient Information Section -->
        <section id="patient-section" class="patient-section">
            <h2>Personal Information</h2>

            <div id="patient-message" class="info-banner" style="display: none;"></div>

            <div id="patient-form-wrapper" class="patient-form">
                <div class="form-group">
                    <label for="patient-id">User ID (if known):</label>
                    <input type="text" id="patient-id" placeholder="Enter your User ID">
                    <button id="search-patient-btn" class="btn btn-secondary">Search User</button>
                </div>
                
                <div class="form-divider">
                    <span>OR</span>
                </div>
                
                <div class="patient-details">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="first-name">First Name:</label>
                            <input type="text" id="first-name" required>
                        </div>
                        <div class="form-group">
                            <label for="last-name">Last Name:</label>
                            <input type="text" id="last-name" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="date-of-birth">Date of Birth:</label>
                            <input type="date" id="date-of-birth" required>
                        </div>
                        <div class="form-group">
                            <label for="gender">Gender:</label>
                            <select id="gender" required>
                                <option value="">Select Gender</option>
                                <option value="male">Male</option>
                                <option value="female">Female</option>
                                <option value="other">Other</option>
                                <option value="prefer-not-to-say">Prefer not to say</option>
                            </select>
                        </div>
                    </div>
                    
                    <button id="save-patient-btn" class="btn btn-primary">Save User Information</button>
                </div>
            </div>
            
            <div id="patient-info-display" class="patient-info-display" style="display: none;">
                <h3>Current Patient</h3>
                <div id="patient-details">
                    <div class="patient-info-grid">
                        <div class="info-item">
                            <strong>ID:</strong> 
                            <span id="patient-id-display">-</span>
                        </div>
                        <div class="info-item">
                            <strong>Name:</strong> 
                            <span id="patient-name-display">-</span>
                        </div>
                        <div class="info-item">
                            <strong>Date of Birth:</strong> 
                            <span id="patient-dob-display">-</span>
                        </div>
                        <div class="info-item">
                            <strong>Gender:</strong> 
                            <span id="patient-gender-display">-</span>
                        </div>
                        <div class="info-item">
                            <strong>Created:</strong> 
                            <span id="patient-created-display">-</span>
                        </div>
                        <div class="info-item" id="patient-updated-item" style="display: none;">
                            <strong>Updated:</strong> 
                            <span id="patient-updated-display">-</span>
                        </div>
                    </div>
                </div>
                <div class="action-buttons">
                    <button id="change-patient-btn" class="btn btn-secondary">Change User</button>
                    <button id="update-patient-btn" class="btn btn-secondary">Update Personal Information</button>
                    <button id="proceed-btn" class="btn btn-primary">Proceed to Recording</button>
                </div>
            </div>
        </section>
        
        <!-- Recording Section -->
        <section id="recording-section" class="recording-section" style="display: none;">
            <h2>Voice Recording</h2>
            
            <div class="status-display">
                <div id="status-indicator" class="status-indicator idle">
                    <span id="status-text">Ready to Record</span>
                </div>
            </div>
            
            <div class="controls">
                <button id="start-btn" class="btn btn-start">
                    <span class="btn-icon">üé§</span>
                    Start Recording
                </button>
                
                <button id="pause-btn" class="btn btn-pause" disabled>
                    <span class="btn-icon">‚è∏Ô∏è</span>
                    Pause
                </button>
                
                <button id="resume-btn" class="btn btn-resume" disabled>
                    <span class="btn-icon">‚ñ∂Ô∏è</span>
                    Resume
                </button>
                
                <button id="stop-btn" class="btn btn-stop" disabled>
                    <span class="btn-icon">‚èπÔ∏è</span>
                    Stop
                </button>
            </div>
            
            <div class="recording-info">
                <div class="timer">
                    <span id="recording-time">00:00</span>
                </div>
                <div class="audio-level">
                    <div class="level-bar">
                        <div id="level-indicator" class="level-fill"></div>
                    </div>
                </div>
            </div>
            
            <div id="audio-playback" class="playback-section" style="display: none;">
                <h3>Recording Playback</h3>
                <audio id="audio-player" controls></audio>
                <div class="playback-controls">
                    <button id="save-recording-btn" class="btn btn-save">
                        <span class="btn-icon">üíæ</span>
                        Save to Database
                    </button>
                    <button id="download-btn" class="btn btn-download">
                        <span class="btn-icon">üì•</span>
                        Download Recording
                    </button>
                </div>
            </div>
            
            <div id="error-message" class="error-message" style="display: none;"></div>
        </section>

        <section id="clinician-dashboard-section" class="clinician-section" style="display: none;">
            <h2>Clinician Dashboard</h2>
            <p>Select a patient and the tests you want to assign to them. A unique link will be generated for the patient to access their test battery.</p>
            
            <div class="form-group">
                <label for="dashboard-patient-select">Select Patient:</label>
                <select id="dashboard-patient-select" class="form-control"></select>
            </div>
            
            <h3>Available Tests</h3>
            <ul id="dashboard-tests-list" class="tests-list">
                </ul>
            
            <button id="create-link-btn" class="btn btn-primary">Create Patient Test Link</button>
            
            <div id="link-container" class="link-container" style="display: none;">
                <label for="link-input">Test Session Link:</label>
                <div class="input-group">
                    <input type="text" id="link-input" class="form-control" readonly>
                    <button id="copy-link-btn" class="btn btn-secondary">Copy</button>
                </div>
            </div>
            
            <p class="mt-2">
                <a href="#patient-manager">Go to Patient Management</a>
            </p>
        </section>

        
        <!-- Database Status -->
        <div id="db-status" class="db-status" style="display: none;">
            <div class="db-stats">
                <h4>Database Status</h4>
                <div class="stats-grid">
                    <div class="stat-item">
                        <strong>Total Patients:</strong> <span id="stat-total-patients">0</span>
                    </div>
                    <div class="stat-item">
                        <strong>Total Recordings:</strong> <span id="stat-total-recordings">0</span>
                    </div>
                    <div class="stat-item">
                        <strong>Total Storage:</strong> <span id="stat-total-storage">0 Bytes</span>
                    </div>
                </div>
            </div>
        </div>

    </div>
    
    <!-- Scripts -->
    <script src="src/config.js"></script>
    <script src="src/services/test-manager.js"></script>
    <script src="src/services/database.js"></script>
    <script src="src/services/patient-manager.js"></script>
    <script src="src/modules/voice-recorder.js"></script>
    <script src="src/app.js"></script>
    <script src="src/services/routing.js"></script>
    <script src="src/modules/clinician-dashboard.js"></script> 
</body>
</html>
